<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero UNO - Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%);
            overflow: hidden;
        }

        .uno-card {
            aspect-ratio: 2/3;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 3rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border: 4px solid white;
            position: relative;
            transform: rotate(-5deg);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .uno-card.red {
            background: linear-gradient(135deg, #ff4b2b, #ff416c);
        }

        .uno-card.blue {
            background: linear-gradient(135deg, #36d1dc, #5b86e5);
        }

        .uno-card.green {
            background: linear-gradient(135deg, #a8e063, #56ab2f);
        }

        .uno-card.yellow {
            background: linear-gradient(135deg, #fce043, #fb7419);
        }

        .uno-card.wild {
            background: linear-gradient(135deg, #232526, #414345);
        }

        .card-inner {
            width: 80%;
            height: 80%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(5deg);
        }

        .player-hand {
            transition: all 0.3s ease;
        }

        .active-player {
            border: 4px solid #facc15;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.5);
            transform: scale(1.05);
        }

        .wild-color-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        @keyframes float {
            0% {
                transform: translateY(0px) rotate(-5deg);
            }

            50% {
                transform: translateY(-20px) rotate(5deg);
            }

            100% {
                transform: translateY(0px) rotate(-5deg);
            }
        }

        .floating {
            animation: float 4s ease-in-out infinite;
        }

        .qr-placeholder {
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>

<body class="min-h-screen text-white p-8">
    <div class="max-w-7xl mx-auto h-full flex flex-col">
        <!-- Header -->
        <header class="flex justify-between items-center mb-12">
            <h1
                class="text-5xl font-black tracking-tighter bg-gradient-to-r from-red-500 via-yellow-400 to-green-500 bg-clip-text text-transparent">
                UNO DIGITAL PREMIUM
            </h1>
            <div id="gameStatus"
                class="bg-white/10 backdrop-blur-md px-6 py-2 rounded-full border border-white/20 font-bold uppercase tracking-widest text-sm">
                Esperando jugadores...
            </div>
        </header>

        <div class="flex-1 grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Players List -->
            <div class="lg:col-span-1 space-y-4">
                <h2 class="text-xl font-bold text-gray-400 uppercase tracking-widest mb-4">Jugadores</h2>
                <div id="playersList" class="space-y-3">
                    <!-- Players injected here -->
                    <p class="text-gray-500 italic">Nadie en la sala aÃºn...</p>
                </div>

                <div class="mt-8 p-6 bg-white/5 rounded-2xl border border-white/10">
                    <p class="text-xs text-gray-400 mb-2 uppercase font-bold">Instrucciones</p>
                    <p class="text-sm text-gray-300">Escanea el QR o entra a <span
                            class="text-yellow-400">/unoplayer</span> para unirte.</p>
                    <button id="startGameBtn"
                        class="w-full mt-4 bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-black py-3 rounded-xl transition-all uppercase tracking-tighter">
                        Comenzar Juego
                    </button>
                </div>
            </div>

            <!-- Central Game Area -->
            <div class="lg:col-span-2 flex flex-col items-center justify-center relative">
                <div id="deckArea" class="mb-12 flex items-center gap-12">
                    <!-- Discard Pile -->
                    <div class="flex flex-col items-center">
                        <p class="text-xs font-bold text-gray-400 mb-4 uppercase tracking-widest">Pozo</p>
                        <div id="topCardContainer" class="w-48 floating">
                            <div class="uno-card wild w-48 h-72">
                                <div class="card-inner text-2xl font-black opacity-20">UNO</div>
                            </div>
                        </div>
                    </div>

                    <!-- Draw Pile (Visual only) -->
                    <div class="flex flex-col items-center opacity-50">
                        <p class="text-xs font-bold text-gray-400 mb-4 uppercase tracking-widest">Mazo</p>
                        <div
                            class="w-48 h-72 bg-gradient-to-br from-gray-700 to-black rounded-2xl border-4 border-white flex items-center justify-center transform rotate-3">
                            <span class="text-4xl font-black text-white/20 uppercase transform -rotate-45">UNO</span>
                        </div>
                    </div>
                </div>

                <!-- Wild Color Indicator -->
                <div id="wildColorArea" class="hidden absolute top-0 right-0 flex flex-col items-center">
                    <p class="text-[10px] font-bold text-gray-400 mb-2 uppercase">Color Elegido</p>
                    <div id="wildColorIndicator" class="wild-color-indicator"></div>
                </div>

                <div id="turnIndicator"
                    class="text-3xl font-black text-yellow-400 uppercase tracking-tighter animate-pulse hidden">
                    Turno de: <span id="currentPlayerName">-</span>
                </div>
            </div>

            <!-- QR & Stats -->
            <div class="lg:col-span-1 flex flex-col justify-between">
                <div
                    class="bg-white rounded-3xl p-6 shadow-2xl min-h-[300px] flex flex-col items-center justify-center">
                    <div id="qrLoading" class="qr-placeholder w-full aspect-square rounded-xl">
                        <div class="flex flex-col items-center">
                            <i class="fas fa-spinner fa-spin text-3xl mb-4"></i>
                            <p>GENERANDO QR...</p>
                        </div>
                    </div>
                    <img id="qrCode" src="" alt="QR Code" class="w-full hidden">
                    <p class="text-center text-xs text-gray-900 font-bold mt-4 uppercase">Escanea para jugar</p>
                </div>

                <div id="celebrationOverlay"
                    class="hidden mt-8 p-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl text-center shadow-2xl animate-bounce">
                    <h2 class="text-4xl font-black text-white mb-2 italic">Â¡GANADOR!</h2>
                    <p id="winnerName" class="text-2xl font-bold text-gray-900 uppercase">Nombre</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io({ transports: ['websocket'] });

        // DOM Elements
        const playersList = document.getElementById('playersList');
        const gameStatus = document.getElementById('gameStatus');
        const topCardContainer = document.getElementById('topCardContainer');
        const currentPlayerName = document.getElementById('currentPlayerName');
        const turnIndicator = document.getElementById('turnIndicator');
        const startGameBtn = document.getElementById('startGameBtn');
        const wildColorArea = document.getElementById('wildColorArea');
        const wildColorIndicator = document.getElementById('wildColorIndicator');
        const celebrationOverlay = document.getElementById('celebrationOverlay');
        const winnerNameEl = document.getElementById('winnerName');

        // Initial state
        socket.emit('uno-state-request'); // Future proofing

        socket.on('uno-state-update', (state) => {
            updatePlayers(state.players, state.currentPlayer);
            updateStatus(state.status);
            if (state.topCard) updateTopCard(state.topCard);
            if (state.qrCodeUrl) {
                const qrImg = document.getElementById('qrCode');
                const qrLoading = document.getElementById('qrLoading');
                qrImg.src = state.qrCodeUrl;
                qrImg.classList.remove('hidden');
                qrLoading.classList.add('hidden');
            }

            if (state.currentPlayer) {
                currentPlayerName.textContent = state.currentPlayer;
                turnIndicator.classList.remove('hidden');
            }

            if (state.wildColor) {
                wildColorArea.classList.remove('hidden');
                wildColorIndicator.style.backgroundColor = state.wildColor;
            } else {
                wildColorArea.classList.add('hidden');
            }
        });

        socket.on('uno-game-over', (data) => {
            celebrationOverlay.classList.remove('hidden');
            winnerNameEl.textContent = data.winner;
            gameStatus.textContent = 'Juego Terminado';
        });

        startGameBtn.addEventListener('click', () => {
            socket.emit('uno-start');
        });

        function updatePlayers(players, currentPlayerName) {
            playersList.innerHTML = '';
            players.forEach(p => {
                const div = document.createElement('div');
                div.className = `p-4 rounded-2xl flex justify-between items-center transition-all ${p.name === currentPlayerName ? 'active-player bg-white/20' : 'bg-white/5 border border-white/10'}`;
                div.innerHTML = `
                    <span class="font-bold">${p.name}</span>
                    <span class="bg-yellow-500 text-gray-900 px-3 py-1 rounded-full text-xs font-black shadow-lg">
                        ${p.cardCount} cartas
                    </span>
                `;
                playersList.appendChild(div);
            });
        }

        function updateTopCard(card) {
            topCardContainer.innerHTML = `
                <div class="uno-card ${card.color} w-48 h-72">
                    <div class="card-inner">
                        <span class="text-6xl font-black text-white drop-shadow-xl">${getCardSymbol(card.value)}</span>
                    </div>
                </div>
            `;
        }

        function getCardSymbol(value) {
            if (value === 'Skip') return '<i class="fas fa-ban"></i>';
            if (value === 'Reverse') return '<i class="fas fa-sync"></i>';
            if (value === '+2') return '+2';
            if (value === '+4') return '+4';
            if (value === 'Wild') return '<i class="fas fa-palette"></i>';
            return value;
        }

        function updateStatus(status) {
            if (status === 'playing') {
                gameStatus.textContent = 'ðŸŸ¢ Partida en curso';
                gameStatus.classList.add('text-green-400');
                startGameBtn.classList.add('hidden');
            } else if (status === 'waiting') {
                gameStatus.textContent = 'ðŸŸ¡ Esperando jugadores';
                gameStatus.classList.remove('text-green-400');
                startGameBtn.classList.remove('hidden');
            }
        }
    </script>
</body>

</html>